@page "/registerEmp"
@using System.ComponentModel.DataAnnotations;
@using System.Text.Json;
@using BlazorApp.Data;
@using Utilities;
@inject IMessageService _message
<Form @ref="form"
      Model="@model"
      OnFinish="OnFinish"
      OnFinishFailed="OnFinishFailed"
      LabelColSpan="8"
      WrapperColSpan="16">
    <GridRow>
        <GridCol Span="12">
            <FormItem Label="First Name">
                <Input @bind-Value="@context.FirstName" />
            </FormItem>
            <FormItem Label="Last Name">
                <Input @bind-Value="@context.LastName" />
            </FormItem>
            <FormItem Label="Home Phone">
                <Input @bind-Value="@context.HomePhone" />
            </FormItem>
        </GridCol>
        <GridCol Span="12">
            <FormItem WrapperColOffset="4" WrapperColSpan="16">
                <Button Type="@ButtonType.Primary" HtmlType="submit">
                    Register
                </Button>
                <Button OnClick="Reset">
                    Clear
                </Button>
            </FormItem>
        </GridCol>
    </GridRow>
</Form>
<RegisterEmpTable @ref="myComponent" skillList="model.EmployeeSkills"></RegisterEmpTable>
 

@code
{
    RegisterEmpTable myComponent;

    private EmployeeRegistrationView model = new EmployeeRegistrationView();


    private Form<EmployeeRegistrationView>  form;


    private EmployeeRegistrationView saveData = new EmployeeRegistrationView();


    private void Reset(MouseEventArgs args)
    {
        form.Reset();
    }
    private async void OnFinish(EditContext editContext)
    {
        var selectedData = myComponent.selectedRows?.ToList();

        if (selectedData==null || selectedData.Count() == 0)
        {
            await _message.Warning("Please Select Verified Skills");
            return;
        }
        var tempData = editContext.Model as EmployeeRegistrationView;
        saveData = CommonHelper.DeepCopy<EmployeeRegistrationView>(tempData);
        var tmepSelectedData = CommonHelper.DeepCopy<List<EmployeeSkillView>>(tempData.EmployeeSkills);
        saveData.EmployeeSkills = tmepSelectedData;

 
        Console.WriteLine($"Success:{JsonSerializer.Serialize(model)}");
    }

    private void OnFinishFailed(EditContext editContext)
    {
        Console.WriteLine($"Failed:{JsonSerializer.Serialize(model)}");
    }
 
    
}